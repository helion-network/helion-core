version: "3.9"

# Volumes:
# - dht-state: stores the DHT identity key so the /p2p/<peer_id> stays stable
volumes:
  dht-state:

networks:
  helion-net:
    name: helion-net

services:
  # -------------------- DHT BOOTSTRAP (CPU-only) --------------------
  dht:
    image: phongnhat19/helion:v0.0.1
    container_name: helion-dht
    # IMPORTANT: Set DHT_PUBLIC_IP to your machine's public IP or DNS name (no port).
    # This ensures peers on the Internet can dial back to you.
    # environment:
    #   - DHT_PUBLIC_IP=${DHT_PUBLIC_IP}
    # env_file:
    #   - ./.env
    command: >
      bash -lc "
      python -m helion.cli.run_dht --identity_path /state/bootstrap.id
      "
    ports:
      - "31337:31337"       # expose for public peers
    volumes:
      - ./helion-cache:/cache
      - ./identity:/home/user/.config/helion
      - dht-state:/state
    networks: [helion-net]
    restart: unless-stopped